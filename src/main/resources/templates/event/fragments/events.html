<!-- 이벤트 리스트 프래그먼트 START -->
<div class="mb-4" th:fragment="events">
    <!-- 이벤트 필터 -->
    <div class="card-header d-flex justify-content-between align-items-center border-0 pb-0">
        <div class="d-flex align-items-center">
            <h5 class="card-title mb-0 me-3">알림</h5>
            <span class="badge bg-primary bg-opacity-10 text-primary"
                  th:text="${events.totalElements ?: 0}">0</span>
        </div>

        <div class="d-flex gap-2">
            <!-- 이벤트 타입 필터 -->
            <label class="visually-hidden" for="event-type-filter">이벤트 타입</label>
            <select class="form-select form-select-sm" hx-get="/members/{memberId}/events/fragment"
                    hx-swap="innerHTML"
                    hx-target="#content-area"
                    id="event-type-filter"
                    name="eventType"
                    style="max-width: 150px;"
                    th:attr="hx-get='/members/' + ${author.id} + '/events/fragment'">
                <option th:selected="${eventType == null}" value="">전체</option>
                <option th:selected="${eventType == 'FOLLOW'}" value="FOLLOW">팔로우</option>
                <option th:selected="${eventType == 'COMMENT'}" value="COMMENT">댓글</option>
                <option th:selected="${eventType == 'HEART'}" value="HEART">좋아요</option>
                <option th:selected="${eventType == 'MENTION'}" value="MENTION">멘션</option>
            </select>
        </div>
    </div>

    <!-- 이벤트 리스트 -->
    <ul class="card-body p-0 list-unstyled" id="events-list">
        <th:block th:if="${events != null and !events.isEmpty()}">
            <li class="event-item border-bottom  mx-3 my-1 rounded"
                th:each="event : ${events.content}"
                th:id="'event-item-' + ${event.id}">
                <div class="p-3">
                    <div class="d-flex align-items-start">
                        <!-- 아이콘 -->
                        <div class="me-3">
                            <div class="icon-lg bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center"
                                 th:classappend="${event.eventType.name() == 'FOLLOW' ? 'text-primary' : (event.eventType.name() == 'COMMENT' ? 'text-success' : (event.eventType.name() == 'HEART' ? 'text-danger' : 'text-warning'))}">
                                <i th:classappend="${event.eventType.name() == 'FOLLOW' ? 'bi bi-person-plus' : (event.eventType.name() == 'COMMENT' ? 'bi bi-chat' : (event.eventType.name() == 'HEART' ? 'bi bi-heart' : 'bi bi-at'))}"></i>
                            </div>
                        </div>

                        <!-- 내용 -->
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <p class="mb-1" th:text="${event.message}">이벤트 내용</p>
                                    <small class="text-muted"
                                           th:text="${#temporals.format(event.createdAt, 'yyyy.MM.dd HH:mm')}">시간</small>
                                </div>

                                <!-- 읽지 않은 표시 -->
                                <div th:if="${!event.isRead}">
                                    <span class="badge bg-danger">새 알림</span>
                                </div>
                            </div>

                            <!-- 관련 링크 -->
                            <div class="mt-2" th:if="${event.relatedPostId != null}">
                                <a class="btn btn-sm btn-outline-primary"
                                   th:href="@{/posts/{postId}(postId=${event.relatedPostId})}">
                                    보러가기
                                </a>
                            </div>
                        </div>

                        <!-- 읽음 표시 버튼 -->
                        <div class="ms-3" th:if="${!event.isRead}">
                            <form hx-on::after-request="htmx.trigger('#events-tab', 'click')"
                                  th:attr="hx-post=@{/api/v1/events/{eventId}/read(id=${author.id}, eventId=${event.id}, fragment=true)},
                                  hx-target='#event-item-' + ${event.id},
                                  hx-swap='none'">
                                <button class="btn btn-sm btn-warning" type="submit">
                                    읽음
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </li>
        </th:block>

        <!-- 이벤트가 없는 경우 -->
        <th:block th:if="${events == null or events.isEmpty()}">
            <div class="text-center py-5">
                <i class="bi bi-bell text-muted" style="font-size: 3rem;"></i>
                <p class="text-muted mt-3">알림이 없습니다</p>
            </div>
        </th:block>
    </ul>

    <!-- 페이지네이션 -->
    <div class="text-center mt-4" th:if="${events != null and events.totalPages > 1}">
        <nav aria-label="Events pagination">
            <ul class="pagination justify-content-center mb-0">
                <!-- 이전 페이지 -->
                <li class="page-item" th:classappend="${events.first} ? 'disabled' : ''">
                    <a aria-disabled="true" class="page-link"
                       href="#"
                       tabindex="-1"
                       th:attr="hx-get='/members/' + ${author.id} + '/events/fragment?page=' + ${events.number - 1},
                               hx-swap='innerHTML',
                               hx-target='#content-area'">
                        <i class="bi bi-chevron-left"></i>
                    </a>
                </li>

                <!-- 페이지 번호 -->
                <li class="page-item"
                    th:classappend="${events.number + 1 == pageNum} ? 'active' : ''"
                    th:each="pageNum : ${#numbers.sequence(1, events.totalPages)}">
                    <a class="page-link" href="#"
                       th:attr="hx-get='/members/' + ${author.id} + '/events/fragment?page=' + ${pageNum - 1},
                               hx-swap='innerHTML',
                               hx-target='#content-area'"
                       th:text="${pageNum}">1</a>
                </li>

                <!-- 다음 페이지 -->
                <li class="page-item" th:classappend="${events.last} ? 'disabled' : ''">
                    <a class="page-link" href="#"
                       th:attr="hx-get='/members/' + ${author.id} + '/events/fragment?page=' + ${events.number + 1},
                               hx-swap='innerHTML',
                               hx-target='#content-area'">
                        <i class="bi bi-chevron-right"></i>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</div>
<!-- 이벤트 리스트 프래그먼트 END -->
