<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Replies Fragment</title>
</head>
<body>

<!-- 답글 목록 프래그먼트 -->
<div th:fragment="replies-list">
    <!-- 답글이 없는 경우 -->
    <div class="text-center py-2" th:if="${replies == null or replies.isEmpty()}">
        <p class="text-muted small mb-0">
            <i class="bi bi-chat-dots me-1"></i>아직 답글이 없습니다
        </p>
    </div>

    <!-- 답글 목록 -->
    <div class="reply-item border-start border-2 border-primary ps-3 mb-3"
         th:each="reply : ${replies.content}">

        <div class="d-flex">
            <!-- 답글 작성자 프로필 이미지 (작은 크기) -->
            <div class="flex-shrink-0 me-2">
                <div class="bg-secondary rounded-circle d-flex align-items-center justify-content-center"
                     style="width: 32px; height: 32px;">
                    <span class="text-white small fw-bold"
                          th:text="${reply.author.nickname.substring(0, 1).toUpperCase()}">A</span>
                </div>
            </div>

            <!-- 답글 내용 -->
            <div class="flex-grow-1">
                <!-- 답글 작성자 정보 -->
                <div class="d-flex align-items-center mb-1">
                    <h6 class="mb-0 me-2 small fw-bold" th:text="${reply.author.nickname}">답글 작성자</h6>
                    <small class="text-muted" th:text="${#temporals.format(reply.createdAt, 'MM-dd HH:mm')}">
                        01-01 12:00
                    </small>
                    <!-- 답글 표시 배지 -->
                    <span class="badge bg-light text-muted ms-2" style="font-size: 0.7rem;">답글</span>
                </div>

                <!-- 답글 텍스트 -->
                <p class="mb-2 small" th:text="${reply.content.text}">답글 내용입니다.</p>

                <!-- 답글 액션 버튼 -->
                <div class="d-flex align-items-center gap-2">
                    <button class="btn btn-sm btn-link p-0 text-muted small">
                        <i class="bi bi-hand-thumbs-up me-1"></i>좋아요
                    </button>
                    <button class="btn btn-sm btn-link p-0 text-muted small">
                        <i class="bi bi-reply me-1"></i>답글
                    </button>
                </div>
            </div>

            <!-- 답글 옵션 드롭다운 -->
            <div class="dropdown">
                <button aria-expanded="false"
                        class="btn btn-sm btn-link text-muted p-1"
                        data-bs-toggle="dropdown"
                        style="font-size: 0.8rem;">
                    <i class="bi bi-three-dots-vertical"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li><a class="dropdown-item small" href="#">
                        <i class="bi bi-flag fa-fw pe-2"></i>신고</a>
                    </li>
                    <li th:if="${reply.author.memberId == member?.memberId}">
                        <a class="dropdown-item small text-danger" href="#">
                            <i class="bi bi-trash fa-fw pe-2"></i>삭제</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- 답글 더보기 (Click to Load 패턴) -->
    <div class="text-center mt-3" th:if="${replies.hasNext()}">
        <button class="btn btn-link btn-sm text-muted p-0"
                th:attr="hx-get='/comments/replies-fragment?commentId=' + ${commentId} + '&page=' + ${replies.number + 1},
                         hx-target='this',
                         hx-swap='outerHTML',
                         hx-indicator='#more-replies-loading-' + ${commentId}">
            <i class="bi bi-arrow-down me-1"></i>답글 더보기
            (<span th:text="${replies.totalElements - replies.numberOfElements}"></span>개 남음)
        </button>

        <!-- 답글 더보기 로딩 인디케이터 -->
        <div class="htmx-indicator mt-2" th:id="'more-replies-loading-' + ${commentId}">
            <div class="spinner-border spinner-border-sm text-secondary">
                <output class="visually-hidden">Loading...</output>
            </div>
            <span class="text-muted small ms-2">답글 불러오는 중...</span>
        </div>
    </div>
</div>

<!-- 단일 답글 프래그먼트 (새로 작성된 답글용) -->
<div class="reply-item border-start border-2 border-primary ps-3 mb-3" th:fragment="single-reply">
    <div class="d-flex">
        <!-- 답글 작성자 프로필 이미지 -->
        <div class="flex-shrink-0 me-2">
            <div class="bg-secondary rounded-circle d-flex align-items-center justify-content-center"
                 style="width: 32px; height: 32px;">
                <span class="text-white small fw-bold"
                      th:text="${comment.author.nickname.substring(0, 1).toUpperCase()}">A</span>
            </div>
        </div>

        <!-- 답글 내용 -->
        <div class="flex-grow-1">
            <!-- 답글 작성자 정보 -->
            <div class="d-flex align-items-center mb-1">
                <h6 class="mb-0 me-2 small fw-bold" th:text="${comment.author.nickname}">답글 작성자</h6>
                <small class="text-muted">방금 전</small>
                <!-- 새 답글 표시 배지 -->
                <span class="badge bg-success text-white ms-2" style="font-size: 0.7rem;">새 답글</span>
            </div>

            <!-- 답글 텍스트 -->
            <p class="mb-2 small" th:text="${comment.content.text}">답글 내용입니다.</p>

            <!-- 답글 액션 버튼 -->
            <div class="d-flex align-items-center gap-2">
                <button class="btn btn-sm btn-link p-0 text-muted small">
                    <i class="bi bi-hand-thumbs-up me-1"></i>좋아요
                </button>
                <button class="btn btn-sm btn-link p-0 text-muted small">
                    <i class="bi bi-reply me-1"></i>답글
                </button>
            </div>
        </div>
    </div>
</div>

<!-- 답글 로딩 상태 프래그먼트 -->
<div th:fragment="replies-loading">
    <div class="text-center py-3">
        <div class="spinner-border spinner-border-sm text-primary">
            <output class="visually-hidden">Loading...</output>
        </div>
        <span class="text-muted small ms-2">답글을 불러오는 중...</span>
    </div>
</div>

<!-- 답글 에러 상태 프래그먼트 -->
<div th:fragment="replies-error">
    <div class="text-center py-3">
        <p class="text-danger small mb-1">
            <i class="bi bi-exclamation-triangle me-1"></i>답글을 불러올 수 없습니다
        </p>
        <button class="btn btn-sm btn-outline-primary"
                th:attr="hx-get='/comments/replies-fragment?commentId=' + ${commentId},
                         hx-target='this',
                         hx-swap='outerHTML'">
            <i class="bi bi-arrow-clockwise me-1"></i>다시 시도
        </button>
    </div>
</div>

</body>
</html>
