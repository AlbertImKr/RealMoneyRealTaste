# RMRT 도메인 요구사항 문서

> 본 문서는 RMRT 서비스의 비즈니스 요구사항과 도메인 규칙을 정의합니다.

## 목차

- [1. 서비스 개요](#1-서비스-개요)
- [2. 회원 관리](#2-회원-관리)
- [3. 게시글 및 리뷰](#3-게시글-및-리뷰)
- [4. 소셜 기능](#4-소셜-기능)
- [5. 컬렉션 기능](#5-컬렉션-기능)
- [6. 친구 관계 시스템](#6-친구-관계-시스템)
- [7. 팔로우 시스템](#7-팔로우-시스템)
- [8. 댓글 시스템](#8-댓글-시스템)
- [9. 신뢰도 시스템](#9-신뢰도-시스템)
- [10. 보안 및 인증](#10-보안-및-인증)
- [11. 비즈니스 규칙](#11-비즈니스-규칙)

---

## 1. 서비스 개요

### 1.1 서비스 목적

**"진짜 내돈내산 푸디들의 소셜 플랫폼"**

### 1.2 핵심 가치

**Real Money First (내돈내산 우선)**

- 내돈내산 리뷰를 가장 높은 가치로 평가
- 신뢰할 수 있는 진짜 맛집 정보 제공

**Transparent Disclosure (투명한 공개)**

- 광고성/내돈내산 구분을 명확히 표시
- 이해관계 투명성으로 신뢰성 확보

**Trust-Based Community (신뢰 기반 커뮤니티)**

- 내돈내산 리뷰에 더 높은 신뢰도 부여
- 커뮤니티 기여도 기반 등급 시스템

**Community Driven (커뮤니티 주도)**

- 내돈내산 중심의 순수한 커뮤니티 문화
- 사용자 참여 기반 품질 관리

---

## 2. 회원 관리

### 2.1 회원 가입

#### 기본 정보 입력

```
필수 정보:
- 이메일: 유효한 형식, 중복 불가
- 닉네임: 한글/영문/숫자, 2-20자, 중복 불가
- 비밀번호: 8-20자, 소문자/대문자/숫자/특수문자 각 1개 이상
```

#### 이메일 인증

- 가입 신청 후 이메일 인증 필수
- 인증 완료 시 PENDING → ACTIVE 상태 전환
- 활성화 토큰: UUID 생성, 만료 시간 설정
- 인증 이메일 재발송 가능 (기존 토큰 무효화)

### 2.2 회원 상태

#### PENDING (등록 대기)

- 이메일 인증 전 상태
- 서비스 조회만 가능
- 리뷰 작성, 소셜 기능 제한

#### ACTIVE (정상 활동)

- 이메일 인증 완료 상태
- 모든 서비스 기능 이용 가능
- 프로필 수정, 비밀번호 변경 가능

#### DEACTIVATED (탈퇴)

- 계정 탈퇴 상태
- 모든 기능 이용 제한
- 데이터 보존 (Soft Delete)

### 2.3 프로필 관리

#### 선택 정보

**프로필 주소**

- 형식: 영문/숫자/한글, 3-15자
- 용도: 고유 URL 경로 (`/profile/{address}`)
- 제약: 중복 불가, 선택 사항

**자기소개**

- 길이: 최대 500자
- 용도: 프로필 페이지 표시
- 제약: 선택 사항

#### 권한

- ACTIVE 상태에서만 수정 가능
- 실시간 중복 검증

### 2.4 역할 시스템

#### 역할 유형

```
USER (기본 역할)
├─ 리뷰 작성
├─ 소셜 기능 이용
└─ 기본 서비스 이용

MANAGER (콘텐츠 관리자)
├─ USER 권한 포함
├─ 콘텐츠 관리
└─ 사용자 관리

ADMIN (시스템 관리자)
├─ MANAGER 권한 포함
├─ 시스템 설정
└─ 전체 관리 기능
```

#### 역할 관리 규칙

- 모든 회원은 최소 USER 역할 보유
- ACTIVE 상태에서만 역할 변경 가능
- 역할 누적 방식 (상위 역할이 하위 역할 포함)

---

## 3. 게시글 및 리뷰

### 3.1 게시글 작성

#### 필수 구성 요소

```
맛집 정보:
- 식당명: 필수, 최대 100자
- 주소: 필수, 최대 255자
- 좌표: 위도(-90~90), 경도(-180~180)

리뷰 내용:
- 텍스트: 필수, 최대 2000자
- 평점: 필수, 1-5점

이미지 (선택):
- 최대 5장
- URL 형태로 저장
- 순서 보장
```

#### 작성 권한

- ACTIVE 상태 회원만 작성 가능
- 본인 게시글만 수정/삭제 가능
- Soft Delete 방식 (PUBLISHED → DELETED)

### 3.2 리뷰 유형 분류

#### 내돈내산 리뷰

- 개인 비용으로 직접 구매
- 순수한 개인 경험 기록
- 신뢰도 +5점
- 피드 우선 노출
- **[내돈내산]** 인증 마크 표시

#### 광고성 리뷰

- 협찬, 제공, 할인 등 혜택 수령
- 명확한 이해관계 공개
- 신뢰도 +1점
- **[광고]** 표시 의무

### 3.3 콘텐츠 관리

#### 게시글 상태

- **PUBLISHED**: 공개 상태 (기본)
- **DELETED**: 삭제 상태 (Soft Delete)

#### 수정/삭제 규칙

- 작성자만 수정/삭제 가능
- PUBLISHED 상태에서만 수정 가능
- 삭제 시 데이터 보존 (복구 가능)

---

## 4. 소셜 기능

### 4.1 좋아요 시스템

#### 기본 규칙

- 회원당 게시글당 1개의 좋아요
- 실시간 좋아요 수 카운팅
- 자신의 게시글에도 좋아요 가능

#### 동시성 처리

- DB 레벨 UPDATE 쿼리
- 이벤트 기반 비동기 카운팅
- Eventually Consistent 허용

### 4.2 조회 시스템

#### 조회 규칙

- 작성자가 아닌 사용자의 조회만 카운팅
- 중복 조회 허용 (세션 기반 제한 없음)
- 비동기 조회 수 증가

### 4.3 팔로우 시스템

#### 관계 유형

- 일방향 팔로우
- 상호 팔로우 시 "맛친구" 관계
- 팔로우한 사용자 리뷰 우선 노출

---

## 5. 컬렉션 기능

### 5.1 컬렉션 생성

#### 필수 구성 요소

```
컬렉션 정보:
- 제목: 필수, 최대 100자
- 설명: 선택, 최대 500자
- 프라이버시: PUBLIC(공개) 또는 PRIVATE(비공개)

소유자 정보:
- 회원 ID: 컬렉션 생성자
- 생성일시: 자동 설정
- 수정일시: 자동 갱신

게시글 목록:
- 포함된 게시글 ID 목록
- 최대 50개 게시글 포함 가능
```

#### 프라이버시 설정

**PUBLIC 컬렉션**

- 모든 사용자가 조회 가능
- 검색 결과에 노출
- 다른 사용자가 팔로우 가능

**PRIVATE 컬렉션**

- 소유자만 조회 가능
- 검색 결과에서 제외
- 초대된 사용자만 접근 가능 (향후 확장)

### 5.2 컬렉션 관리

#### 상태 관리

- **ACTIVE**: 정상 활동 상태 (기본)
- **DELETED**: 삭제 상태 (Soft Delete)

#### 수정/삭제 규칙

- 소유자만 수정/삭제 가능
- ACTIVE 상태에서만 수정 가능
- 삭제 시 데이터 보존 (복구 가능)
- 컬렉션 삭제 시 포함된 게시글은 삭제되지 않음

### 5.3 게시글 관리

#### 게시글 추가/제거

- 소유자만 게시글 추가/제거 가능
- 중복 게시글 추가 방지
- 삭제된 게시글은 자동으로 컬렉션에서 제거
- 최대 50개 게시글 제한

#### 정렬 기능

- 최신순 (기본)
- 제목순
- 평점순
- 생성일순

---

## 6. 친구 관계 시스템

### 6.1 친구 요청

#### 요청 프로세스

```
1. 사용자 A가 사용자 B에게 친구 요청 발송
2. 사용자 B에게 알림 표시
3. 사용자 B가 수락/거절/무시 선택
4. 상태에 따라 관계 변경
```

#### 요청 규칙

- ACTIVE 상태 회원만 요청 가능
- 자기 자신에게 요청 불가
- 이미 친구인 사용자에게 요청 불가
- 대기 중인 요청이 있으면 추가 요청 불가

### 6.2 친구 관계 상태

#### 상태 유형

**PENDING (요청 대기)**

- 친구 요청이 발송된 상태
- 상대방이 응답을 기다리는 중
- 언제든지 요청 취소 가능

**ACCEPTED (친구 관계 성립)**

- 양방향 친구 관계
- 서로의 프로필 우선 접근 가능
- 친구 전용 기능 이용 가능

**REJECTED (요청 거절)**

- 친구 요청이 거절된 상태
- 30일간 재요청 제한
- 거절 기록 보관 (향후 확장)

**UNFRIENDED (관계 해제)**

- 친구 관계가 해제된 상태
- 7일간 재요청 제한
- 관계 해제 기록 보관

### 6.3 친구 관리

#### 관리 기능

- 친구 목록 조회
- 친구 요청 목록 조회
- 받은 요청 수락/거절
- 보낸 요청 취소
- 친구 관계 해제

#### 제한 조건

- 최대 500명 친구 제한
- 하루 10명 친구 요청 제한
- 스팸 방지를 위한 레이트 리미트

---

## 7. 팔로우 시스템

### 7.1 팔로우 관계

#### 기본 규칙

- 일방향 관계 (A가 B를 팔로우)
- 팔로우 대상에게 알림 전송 (선택)
- 팔로워 수 실시간 카운팅
- 팔로우한 사용자의 게시글 우선 노출

#### 상태 관리

- **ACTIVE**: 정상 팔로우 상태
- **UNFOLLOWED**: 언팔로우된 상태
- **BLOCKED**: 관리자에 의해 차단된 상태

### 7.2 팔로우 기능

#### 팔로우/언팔로우

- ACTIVE 상태 회원만 팔로우 가능
- 자기 자신 팔로우 불가
- 차단된 사용자 팔로우 불가
- 팔로우/언팔로우 히스토리 보관

#### 맛친구 관계

- 상호 팔로우 시 "맛친구" 관계 자동 성립
- 맛친구는 특별 표시 및 혜택 제공
- 맛친구 추천 알고리즘 (향후 확장)

### 7.3 팔로우 관리

#### 관리 기능

- 팔로잉 목록 조회
- 팔로워 목록 조회
- 맛친구 목록 조회
- 팔로우 추천 (향후 확장)

#### 제한 조건

- 최대 1000명 팔로잉 제한
- 하루 50명 팔로우 제한
- 스팸 방지를 위한 레이트 리미트

---

## 8. 댓글 시스템

### 8.1 댓글 작성

#### 필수 구성 요소

```
댓글 정보:
- 내용: 필수, 최대 1000자
- 작성자: 댓글 작성자 정보
- 대상 게시글: 댓글이 달린 게시글

부가 정보:
- 부모 댓글: 대댓글인 경우 부모 댓글 ID
- 멘션: @닉네임 형태의 사용자 멘션 (최대 5명)
- 생성일시: 자동 설정
- 수정일시: 수정 시 자동 갱신
```

#### 작성 권한

- ACTIVE 상태 회원만 작성 가능
- 삭제된 게시글에는 댓글 작성 불가
- 본인 댓글만 수정/삭제 가능

### 8.2 댓글 관리

#### 상태 관리

- **PUBLISHED**: 공개 상태 (기본)
- **DELETED**: 삭제 상태 (Soft Delete)

#### 수정/삭제 규칙

- 작성자만 수정/삭제 가능
- PUBLISHED 상태에서만 수정 가능
- 삭제 시 데이터 보존 (복구 가능)
- 대댓글이 있는 댓글은 삭제 제한 (향후 확장)

### 8.3 대댓글 시스템

#### 대댓글 규칙

- 2단계까지만 허용 (댓글 → 대댓글)
- 최대 100자 길이 제한
- 부모 댓글이 삭제되면 대댓글도 함께 삭제

#### 멘션 기능

- @닉네임 형식으로 사용자 멘션
- 멘션된 사용자에게 알림 전송
- 최대 5명까지 멘션 가능
- 존재하지 않는 닉네임은 멘션에서 제외

---

## 9. 신뢰도 시스템

### 9.1 점수 산정

#### 점수 가중치

```
활동별 점수:
- 내돈내산 리뷰: +5점
- 광고성 리뷰: +1점
- 도움됨 받기: +2점
- 규칙 위반: -20점
```

#### 계산 공식

```
총 신뢰도 = (내돈내산 리뷰 × 5) + (광고성 리뷰 × 1) + (도움됨 × 2) - (위반 × 20)
범위: 0-1000점
```

### 9.2 등급 시스템

#### 신뢰도 레벨

```
BRONZE: 0-199점
├─ 신규 회원 기본 등급
└─ 기본 서비스 이용

SILVER: 200-499점  
├─ 일정 활동 달성
└─ 추가 기능 해금

GOLD: 500-799점
├─ 활발한 커뮤니티 참여
└─ 인플루언서 자격 요건

DIAMOND: 800-1000점
├─ 최고 신뢰도 등급
└─ 모든 특별 기능 이용
```

### 9.3 내돈내산 비율

#### 계산 방식

```
내돈내산 비율 = 내돈내산 리뷰 수 / 전체 리뷰 수 × 100%
```

#### 활용

- 프로필에 표시
- 신뢰도 등급 산정 참고
- 인플루언서 자격 요건

---

## 10. 보안 및 인증

### 10.1 비밀번호 관리

#### 비밀번호 정책

```
요구사항:
- 길이: 8-20자
- 구성: 소문자/대문자/숫자/특수문자 각 1개 이상
- 허용 특수문자: !@#$%^&*

보안 조치:
- BCrypt 해싱 저장
- 평문 저장 금지
- 안전한 비교 연산
```

#### 비밀번호 재설정

```
프로세스:
1. 이메일 주소 입력
2. 재설정 토큰 발송 (존재하지 않는 이메일도 동일 응답)
3. 토큰 통한 새 비밀번호 설정
4. 토큰 즉시 삭제

보안 고려사항:
- 회원 존재 여부 노출 금지
- 토큰 만료 시간 설정
- 사용 후 즉시 삭제
```

### 10.2 토큰 관리

#### 활성화 토큰

- 용도: 이메일 인증
- 생성: UUID 기반
- 만료: 설정된 시간 후
- 제약: 회원당 1개

#### 재설정 토큰

- 용도: 비밀번호 재설정
- 생성: UUID 기반
- 만료: 설정된 시간 후
- 제약: 여러 개 동시 존재 가능

---

## 11. 비즈니스 규칙

### 11.1 데이터 유효성

#### 텍스트 길이 제한

```
회원 정보:
- 닉네임: 2-20자
- 비밀번호: 8-20자
- 프로필 주소: 3-15자
- 자기소개: 최대 500자

게시글:
- 리뷰 내용: 최대 2000자
- 식당명: 최대 100자
- 주소: 최대 255자
- 이미지 URL: 최대 500자

컬렉션:
- 제목: 최대 100자
- 설명: 최대 500자

댓글:
- 내용: 최대 1000자
- 대댓글: 최대 100자
```

#### 형식 제약

```
정규식 검증:
- 이메일: RFC 5322 준수
- 닉네임: 한글/영문/숫자만 허용
- 프로필 주소: 영문/숫자/한글만 허용

숫자 범위:
- 평점: 1-5
- 위도: -90.0 ~ 90.0
- 경도: -180.0 ~ 180.0
- 신뢰도: 0-1000
```

### 11.2 상태 전이 규칙

#### 회원 상태

```
PENDING → ACTIVE: 이메일 인증 완료
ACTIVE → DEACTIVATED: 계정 탈퇴
기타 전이: 불가 (예외 발생)
```

#### 게시글 상태

```
PUBLISHED → DELETED: 게시글 삭제 (작성자만)
DELETED → PUBLISHED: 복구 불가
기타 전이: 불가 (예외 발생)
```

#### 컬렉션 상태

```
ACTIVE → DELETED: 컬렉션 삭제 (소유자만)
DELETED → ACTIVE: 복구 불가
기타 전이: 불가 (예외 발생)
```

#### 친구 관계 상태

```
PENDING → ACCEPTED: 친구 요청 수락
PENDING → REJECTED: 친구 요청 거절
PENDING → UNFRIENDED: 요청 취소
ACCEPTED → UNFRIENDED: 친구 관계 해제
기타 전이: 불가 (예외 발생)
```

#### 팔로우 상태

```
ACTIVE → UNFOLLOWED: 언팔로우
UNFOLLOWED → ACTIVE: 재팔로우 가능
ACTIVE → BLOCKED: 관리자 차단
BLOCKED → UNFOLLOWED: 차단 해제
기타 전이: 불가 (예외 발생)
```

#### 댓글 상태

```
PUBLISHED → DELETED: 댓글 삭제 (작성자만)
DELETED → PUBLISHED: 복구 불가
기타 전이: 불가 (예외 발생)
```

### 11.3 권한 제어

#### 기능별 권한

```
게시글 작성: ACTIVE 상태 + USER 역할
게시글 수정: 작성자 본인
게시글 삭제: 작성자 본인

컬렉션 생성: ACTIVE 상태 + USER 역할
컬렉션 수정: 소유자 본인
컬렉션 삭제: 소유자 본인

친구 요청: ACTIVE 상태 + USER 역할
친구 관리: 관계에 속한 사용자

팔로우: ACTIVE 상태 + USER 역할
언팔로우: 팔로우 관계에 속한 사용자

댓글 작성: ACTIVE 상태 + USER 역할
댓글 수정: 작성자 본인
댓글 삭제: 작성자 본인

프로필 수정: ACTIVE 상태
비밀번호 변경: ACTIVE 상태
역할 관리: ADMIN 역할
```

#### 예외 처리

- 권한 부족 시 명확한 예외 메시지
- 보안 정보 노출 방지
- 적절한 HTTP 상태 코드 반환

---
