# RMRT 도메인 요구사항 문서

> 본 문서는 RMRT 서비스의 비즈니스 요구사항과 도메인 규칙을 정의합니다.

## 목차

- [1. 서비스 개요](#1-서비스-개요)
- [2. 회원 관리](#2-회원-관리)
- [3. 게시글 및 리뷰](#3-게시글-및-리뷰)
- [4. 소셜 기능](#4-소셜-기능)
- [5. 신뢰도 시스템](#5-신뢰도-시스템)
- [6. 보안 및 인증](#6-보안-및-인증)
- [7. 비즈니스 규칙](#7-비즈니스-규칙)

---

## 1. 서비스 개요

### 1.1 서비스 목적

**"진짜 내돈내산 푸디들의 소셜 플랫폼"**

### 1.2 핵심 가치

**Real Money First (내돈내산 우선)**

- 내돈내산 리뷰를 가장 높은 가치로 평가
- 신뢰할 수 있는 진짜 맛집 정보 제공

**Transparent Disclosure (투명한 공개)**

- 광고성/내돈내산 구분을 명확히 표시
- 이해관계 투명성으로 신뢰성 확보

**Trust-Based Community (신뢰 기반 커뮤니티)**

- 내돈내산 리뷰에 더 높은 신뢰도 부여
- 커뮤니티 기여도 기반 등급 시스템

**Community Driven (커뮤니티 주도)**

- 내돈내산 중심의 순수한 커뮤니티 문화
- 사용자 참여 기반 품질 관리

---

## 2. 회원 관리

### 2.1 회원 가입

#### 기본 정보 입력

```
필수 정보:
- 이메일: 유효한 형식, 중복 불가
- 닉네임: 한글/영문/숫자, 2-20자, 중복 불가
- 비밀번호: 8-20자, 소문자/대문자/숫자/특수문자 각 1개 이상
```

#### 이메일 인증

- 가입 신청 후 이메일 인증 필수
- 인증 완료 시 PENDING → ACTIVE 상태 전환
- 활성화 토큰: UUID 생성, 만료 시간 설정
- 인증 이메일 재발송 가능 (기존 토큰 무효화)

### 2.2 회원 상태

#### PENDING (등록 대기)

- 이메일 인증 전 상태
- 서비스 조회만 가능
- 리뷰 작성, 소셜 기능 제한

#### ACTIVE (정상 활동)

- 이메일 인증 완료 상태
- 모든 서비스 기능 이용 가능
- 프로필 수정, 비밀번호 변경 가능

#### DEACTIVATED (탈퇴)

- 계정 탈퇴 상태
- 모든 기능 이용 제한
- 데이터 보존 (Soft Delete)

### 2.3 프로필 관리

#### 선택 정보

**프로필 주소**

- 형식: 영문/숫자/한글, 3-15자
- 용도: 고유 URL 경로 (`/profile/{address}`)
- 제약: 중복 불가, 선택 사항

**자기소개**

- 길이: 최대 500자
- 용도: 프로필 페이지 표시
- 제약: 선택 사항

#### 권한

- ACTIVE 상태에서만 수정 가능
- 실시간 중복 검증

### 2.4 역할 시스템

#### 역할 유형

```
USER (기본 역할)
├─ 리뷰 작성
├─ 소셜 기능 이용
└─ 기본 서비스 이용

MANAGER (콘텐츠 관리자)
├─ USER 권한 포함
├─ 콘텐츠 관리
└─ 사용자 관리

ADMIN (시스템 관리자)
├─ MANAGER 권한 포함
├─ 시스템 설정
└─ 전체 관리 기능
```

#### 역할 관리 규칙

- 모든 회원은 최소 USER 역할 보유
- ACTIVE 상태에서만 역할 변경 가능
- 역할 누적 방식 (상위 역할이 하위 역할 포함)

---

## 3. 게시글 및 리뷰

### 3.1 게시글 작성

#### 필수 구성 요소

```
맛집 정보:
- 식당명: 필수, 최대 100자
- 주소: 필수, 최대 255자
- 좌표: 위도(-90~90), 경도(-180~180)

리뷰 내용:
- 텍스트: 필수, 최대 2000자
- 평점: 필수, 1-5점

이미지 (선택):
- 최대 5장
- URL 형태로 저장
- 순서 보장
```

#### 작성 권한

- ACTIVE 상태 회원만 작성 가능
- 본인 게시글만 수정/삭제 가능
- Soft Delete 방식 (PUBLISHED → DELETED)

### 3.2 리뷰 유형 분류

#### 내돈내산 리뷰

- 개인 비용으로 직접 구매
- 순수한 개인 경험 기록
- 신뢰도 +5점
- 피드 우선 노출
- **[내돈내산]** 인증 마크 표시

#### 광고성 리뷰

- 협찬, 제공, 할인 등 혜택 수령
- 명확한 이해관계 공개
- 신뢰도 +1점
- **[광고]** 표시 의무

### 3.3 콘텐츠 관리

#### 게시글 상태

- **PUBLISHED**: 공개 상태 (기본)
- **DELETED**: 삭제 상태 (Soft Delete)

#### 수정/삭제 규칙

- 작성자만 수정/삭제 가능
- PUBLISHED 상태에서만 수정 가능
- 삭제 시 데이터 보존 (복구 가능)

---

## 4. 소셜 기능

### 4.1 좋아요 시스템

#### 기본 규칙

- 회원당 게시글당 1개의 좋아요
- 실시간 좋아요 수 카운팅
- 자신의 게시글에도 좋아요 가능

#### 동시성 처리

- DB 레벨 UPDATE 쿼리
- 이벤트 기반 비동기 카운팅
- Eventually Consistent 허용

### 4.2 조회 시스템

#### 조회 규칙

- 작성자가 아닌 사용자의 조회만 카운팅
- 중복 조회 허용 (세션 기반 제한 없음)
- 비동기 조회 수 증가

### 4.3 팔로우 시스템 (향후 확장)

#### 관계 유형

- 일방향 팔로우
- 상호 팔로우 시 "맛친구" 관계
- 팔로우한 사용자 리뷰 우선 노출

---

## 5. 신뢰도 시스템

### 5.1 점수 산정

#### 점수 가중치

```
활동별 점수:
- 내돈내산 리뷰: +5점
- 광고성 리뷰: +1점
- 도움됨 받기: +2점
- 규칙 위반: -20점
```

#### 계산 공식

```
총 신뢰도 = (내돈내산 리뷰 × 5) + (광고성 리뷰 × 1) + (도움됨 × 2) - (위반 × 20)
범위: 0-1000점
```

### 5.2 등급 시스템

#### 신뢰도 레벨

```
BRONZE: 0-199점
├─ 신규 회원 기본 등급
└─ 기본 서비스 이용

SILVER: 200-499점  
├─ 일정 활동 달성
└─ 추가 기능 해금

GOLD: 500-799점
├─ 활발한 커뮤니티 참여
└─ 인플루언서 자격 요건

DIAMOND: 800-1000점
├─ 최고 신뢰도 등급
└─ 모든 특별 기능 이용
```

### 5.3 내돈내산 비율

#### 계산 방식

```
내돈내산 비율 = 내돈내산 리뷰 수 / 전체 리뷰 수 × 100%
```

#### 활용

- 프로필에 표시
- 신뢰도 등급 산정 참고
- 인플루언서 자격 요건

---

## 6. 보안 및 인증

### 6.1 비밀번호 관리

#### 비밀번호 정책

```
요구사항:
- 길이: 8-20자
- 구성: 소문자/대문자/숫자/특수문자 각 1개 이상
- 허용 특수문자: !@#$%^&*

보안 조치:
- BCrypt 해싱 저장
- 평문 저장 금지
- 안전한 비교 연산
```

#### 비밀번호 재설정

```
프로세스:
1. 이메일 주소 입력
2. 재설정 토큰 발송 (존재하지 않는 이메일도 동일 응답)
3. 토큰 통한 새 비밀번호 설정
4. 토큰 즉시 삭제

보안 고려사항:
- 회원 존재 여부 노출 금지
- 토큰 만료 시간 설정
- 사용 후 즉시 삭제
```

### 6.2 토큰 관리

#### 활성화 토큰

- 용도: 이메일 인증
- 생성: UUID 기반
- 만료: 설정된 시간 후
- 제약: 회원당 1개

#### 재설정 토큰

- 용도: 비밀번호 재설정
- 생성: UUID 기반
- 만료: 설정된 시간 후
- 제약: 여러 개 동시 존재 가능

---

## 7. 비즈니스 규칙

### 7.1 데이터 유효성

#### 텍스트 길이 제한

```
회원 정보:
- 닉네임: 2-20자
- 비밀번호: 8-20자
- 프로필 주소: 3-15자
- 자기소개: 최대 500자

게시글:
- 리뷰 내용: 최대 2000자
- 식당명: 최대 100자
- 주소: 최대 255자
- 이미지 URL: 최대 500자
```

#### 형식 제약

```
정규식 검증:
- 이메일: RFC 5322 준수
- 닉네임: 한글/영문/숫자만 허용
- 프로필 주소: 영문/숫자/한글만 허용

숫자 범위:
- 평점: 1-5
- 위도: -90.0 ~ 90.0
- 경도: -180.0 ~ 180.0
- 신뢰도: 0-1000
```

### 7.2 상태 전이 규칙

#### 회원 상태

```
PENDING → ACTIVE: 이메일 인증 완료
ACTIVE → DEACTIVATED: 계정 탈퇴
기타 전이: 불가 (예외 발생)
```

#### 게시글 상태

```
PUBLISHED → DELETED: 게시글 삭제 (작성자만)
DELETED → PUBLISHED: 복구 불가
기타 전이: 불가 (예외 발생)
```

### 7.3 권한 제어

#### 기능별 권한

```
게시글 작성: ACTIVE 상태 + USER 역할
게시글 수정: 작성자 본인
게시글 삭제: 작성자 본인
프로필 수정: ACTIVE 상태
비밀번호 변경: ACTIVE 상태
역할 관리: ADMIN 역할
```

#### 예외 처리

- 권한 부족 시 명확한 예외 메시지
- 보안 정보 노출 방지
- 적절한 HTTP 상태 코드 반환

---
